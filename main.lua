local Gamestate = require "hump.gamestate"
bump = require "bump/bump"
local map_utils = require "map_utils"
require "objects"

gs = {}
gs.game = {}
require "controls"

require "startend"

local game = gs.game
local lg = love.graphics
local isDown = love.keyboard.isDown

function love.load()
	W, H = 80*16, 60*16
  love.window.setMode(W, H, {resizable = false})
	Gamestate.registerEvents()
	Gamestate.switch(gs.start)
	coll = bump.newWorld()
	player = Player()
	testEnemy = RifleShooter(1, 100, 100)
	yourDumb = RifleShooter(2, 200, 100)
	iHitYou = Brawler(3, 300, 100)

  map = map_utils.strls_to_map(80, 60,
  {
    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X-----------------------------------XXXXX--------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "X------------------------------------------------------------------------------X",
    "XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX"
    }
  )
end  


function game:enter()
	player:reset()
end

function game:update(dt)
	if player.x < 0 or player.x > W or player.y < 0 or player.y > H then
		Gamestate.switch(gs.over)
	end
	for i, entity in pairs(EntitiesList) do
		entity:update(dt)
	end
end

function game:draw()
  map:draw()
	player:draw()
	for i, entity in pairs(EntitiesList) do
		entity:draw()
	end
end
